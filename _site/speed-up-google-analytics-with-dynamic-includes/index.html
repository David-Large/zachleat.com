<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Speed up Including <span class="widow">Google Analytics</span>—zachleat.com</title>
		<link href="/atom.xml" rel="alternate" title="Web 367 via zachleat.com" type="application/atom+xml">

		<link href="/web/css/global.css" rel="stylesheet">
	</head>
	<body>
		<div class="rail">
			<header>
				<a href="/web/">
					<h1>Web 3.0, 6 Bladed Razors, 7 Minute Abs</h1>
				</a>
				<h2>A bunch of words by zachleat.</h2>
			</header>
			<aside>
				<nav role="navigation">
				</nav>
			</aside>
		</div>
		<div class="content">
			<div class="main" data-role="main">
				<article>
<h1>Speed up Including <span class="widow">Google Analytics</span></h1>
<em>Posted on 01 Nov 2007</em>
<h1></h1>

<p>Have you ever noticed that your homepage hangs when including the Google Analytics JavaScript file? I think <a href="http://nutrun.com/weblog/does-google-analytics-make-your-pages-slow/">a few</a> <a href="http://resistmedia.net/blog/2007/10/02/get-rid-of-google-analytics/">people</a> have noticed a delay. Well, let’s try something different. Let’s create the script node dynamically using DOM methods and put a timeout on this creation so that it inserts just enough delay so that your page won’t hang (we’ll move out of the current execution path with the timeout, thus allowing your page to finish loading). The obvious benefit here is that even when the Google servers lag a little bit serving you the JavaScript file, your page will appear as if it has already finished loading. Given optimally performing Google Servers, this method will perform slower most of the time, but it shines in those rare instances where there is a bit of a delay. Give it a try, and let me know if it works any better.</p>

<p>Of course, remember to put near the end of your <code>, and not directly in your</code>.</p>

<pre><code>&amp;#40;function&amp;#40;&amp;#41;
&amp;#123;
    setTimeout&amp;#40;function&amp;#40;&amp;#41;
    &amp;#123;
        var node = document.createElement&amp;#40;"script"&amp;#41;;
        node.src = 'http://www.google-analytics.com/urchin.js';
        //for SSL
        //node.src = 'https://ssl.google-analytics.com/urchin.js';
        node.type = 'text/javascript';
        document.getElementsByTagName&amp;#40;"head"&amp;#41;&amp;#91;&amp;#93;.appendChild&amp;#40;node&amp;#41;;
        var init = setInterval&amp;#40;function&amp;#40;&amp;#41;
        &amp;#123;
            _uacct = 'UA-XXXXXX-X'; // INSERT YOUR CODE HERE
            if&amp;#40;typeof urchinTracker != 'undefined'&amp;#41; &amp;#123;
                urchinTracker&amp;#40;&amp;#41;;
                clearInterval&amp;#40;init&amp;#41;;
            &amp;#125;
        &amp;#125;, 100&amp;#41;;
    &amp;#125;, &amp;#41;;
&amp;#125;&amp;#41;&amp;#40;&amp;#41;;
</code></pre>

<p><a href="http://www.zachleat.com/Projects/googleAnalytics/">Try it on my benchmark page.</a></p>

</article>
			</div><!-- /.main -->
		</div><!-- /.content -->
		<script type="text/javascript">
		// var _gaq = _gaq || [];
		// _gaq.push(['_setAccount', '']);
		// _gaq.push(['_trackPageview']);

		// (function() {
		// 	var ga = document.createElement('script');
		// 	ga.type = 'text/javascript';
		// 	ga.async = true;
		// 	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		// 	var s = document.getElementsByTagName('script')[0];
		// 	s.parentNode.insertBefore(ga, s);
		// })();
		</script>
	</body>
</html>