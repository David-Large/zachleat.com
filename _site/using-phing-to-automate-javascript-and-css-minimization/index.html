<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Using Phing to automate JavaScript and <span class="widow">CSS Minimization</span>—zachleat.com</title>
		<link href="/atom.xml" rel="alternate" title="Web 367 via zachleat.com" type="application/atom+xml">

		<link href="/web/css/global.css" rel="stylesheet">
	</head>
	<body>
		<div class="rail">
			<header>
				<a href="/web/">
					<h1>Web 3.0, 6 Bladed Razors, 7 Minute Abs</h1>
				</a>
				<h2>A bunch of words by zachleat.</h2>
			</header>
			<aside>
				<nav role="navigation">
				</nav>
			</aside>
		</div>
		<div class="content">
			<div class="main" data-role="main">
				<article>
<h1>Using Phing to automate JavaScript and <span class="widow">CSS Minimization</span></h1>
<em>Posted on 11 Aug 2007</em>
<h1></h1>

<p><em>This article may be too advanced for beginner programmers. Unfortunately, I will not support any code that I do not write (in this case), so if you have troubles installing some of the packages required below, please see the authors of the problem code. Thank you.</em></p>

<p>PHING! <a href="http://en.wikipedia.org/wiki/Wayne's_World">Party on Wayne. Party on Garth!</a></p>

<p>If you’ve never used Phing, it’s an automation tool for PHP that is a port of Java’s ANT Build tool. But it’s not just for building (obviously, that’d be silly). You can hook all kinds of tasks into Phing: unit tests for your PHP code (you’re doing test driven development, aren’t you?), building your documentation, etc. But today, let’s look at automation of my favorite front end development tasks: packing (minimizing) our JavaScript and CSS.</p>

<p>To do this, I’m going to hook you up with two Filters for Phing that will use the <a href="http://joliclic.free.fr/php/javascript-packer/en/">PHP port of Dean Edwards JavaScript Packer</a>, and the PHP class <a href="http://csstidy.sourceforge.net/">CSSTidy</a>.</p>

<p>Here’s what you’ll be responsible for:</p>

<ol>
<li>Download both CSSTidy and the PHP port of Packer using the links above.</li>
<li>Download Phing if you don’t already have it, and install it. Note the following change I had to make to my Phing binphing.bat file to get it working: Change <code>set PHP_CLASSPATH="%PHING_HOME%classes"</code> to remove the quotes: <code>set PHP_CLASSPATH=%PHING_HOME%classes</code></li>
<li>Download the two Filters I made for Phing: <strong><a href="/Projects/phing/JSPackerFilter.phps">JSPackerFilter.phps</a></strong> and <strong><a href="/Projects/phing/CssTidyFilter.phps">CssTidyFilter.phps</a></strong>, change the extensions to .php and copy into your phing directory classesphingfilters</li>
<li><p>Change the path in the include_once declaration at the top of each of the files to point to the csstidy and packer libraries you downloaded above:</p>

<pre><code>include_once "C:Libpacker.php-1.0class.JavaScriptPacker.php";


include_once "C:Libcsstidy-1.3class.csstidy.php";
</code></pre></li>
<li><p>Get a working build file set up to point the directories your project is using. Here is a sample I made:</p>

<pre><code>&amp;nbsp;














&amp;nbsp;
</code></pre>

<p>Templates for CssTidy include: low_compression, default, high_compression (declarations are limited to one line apiece), highest_compression (everything is put on one line).</p>

<p>The above build file is set up to work with the following directory structure:</p>

<ul>
<li>Build

<ul>
<li>Web

<ul>
<li>css</li>
<li>js</li>
</ul>
</li>
<li><strong>build.xml</strong></li>
</ul>
</li>
<li>Web

<ul>
<li>css</li>
<li>js</li>
</ul>
</li>
</ul>


<p>Files are copied from the source in /Web to the /Build/Web directory. I hope that you can see from the build.xml file above that the target directory is specified in the copy tag, todir attribute.</p>

<p>and the source directory is specified in the fileset tag, dir attribute.</p></li>
</ol>


<p>And then, all you need to do is navigate to the directory holding your build.xml and run the phing command (if you have phing in your path. If not, you can use an absolute link to phing, for example c:softwarephingbinphing). Your minimized javascript and css will be in the Build directory!</p>

</article>
			</div><!-- /.main -->
		</div><!-- /.content -->
		<script type="text/javascript">
		// var _gaq = _gaq || [];
		// _gaq.push(['_setAccount', '']);
		// _gaq.push(['_trackPageview']);

		// (function() {
		// 	var ga = document.createElement('script');
		// 	ga.type = 'text/javascript';
		// 	ga.async = true;
		// 	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		// 	var s = document.getElementsByTagName('script')[0];
		// 	s.parentNode.insertBefore(ga, s);
		// })();
		</script>
	</body>
</html>